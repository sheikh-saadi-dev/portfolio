<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel â€” Sheikh Saadi</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{--gold:#c9a84c;--gl:#e8c87a;--gd:#9a7a2e;--ink:#080808;--s1:#0f0f0f;--s2:#161616;--s3:#1e1e1e;--mu:#777;--br:rgba(201,168,76,0.15);--tx:#e8e8e8;--red:#e85757;--grn:#25d366;--r:14px}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:"Space Grotesk",sans-serif;background:var(--ink);color:var(--tx);min-height:100vh;display:flex}
h1,h2,h3{font-family:"Syne",sans-serif}

/* â”€â”€ LOGIN OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#login{position:fixed;inset:0;z-index:9999;background:var(--ink);display:flex;align-items:center;justify-content:center;transition:opacity .5s,visibility .5s}
#login.hide{opacity:0;visibility:hidden;pointer-events:none}
.lb-box{width:100%;max-width:400px;padding:48px 40px;background:var(--s1);border:1px solid var(--br);border-radius:24px;box-shadow:0 30px 80px rgba(0,0,0,.6);text-align:center}
.lb-title{font-family:"Syne",sans-serif;font-weight:800;font-size:2rem;background:linear-gradient(135deg,var(--gl),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:6px}
.lb-sub{color:var(--mu);font-size:.85rem;margin-bottom:32px}
.lf{margin-bottom:16px;text-align:left}
.lf label{display:block;font-size:.72rem;font-weight:700;color:var(--mu);text-transform:uppercase;letter-spacing:2px;margin-bottom:8px}
.lf input{width:100%;padding:13px 16px;border:1px solid var(--br);border-radius:12px;background:var(--s2);color:var(--tx);font-family:"Space Grotesk",sans-serif;font-size:.92rem;outline:none;transition:border-color .3s}
.lf input:focus{border-color:rgba(201,168,76,.5);box-shadow:0 0 0 3px rgba(201,168,76,.08)}
.lbtn{width:100%;padding:14px;background:linear-gradient(135deg,var(--gl),var(--gold));color:#080808;border:none;border-radius:50px;font-weight:700;font-size:.95rem;cursor:pointer;font-family:"Space Grotesk",sans-serif;margin-top:8px;transition:transform .2s,box-shadow .2s;box-shadow:0 6px 20px rgba(201,168,76,.3)}
.lbtn:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(201,168,76,.4)}
.lerr{color:var(--red);font-size:.82rem;margin-top:10px;display:none}
.db-status{margin-top:14px;font-size:.78rem;display:flex;align-items:center;justify-content:center;gap:7px;color:var(--mu)}
.db-dot{width:8px;height:8px;border-radius:50%;background:var(--mu);flex-shrink:0}
.db-dot.ok{background:var(--grn);animation:pulse 2s infinite}
.db-dot.err{background:var(--red)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sb{width:250px;background:var(--s1);border-right:1px solid var(--br);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100}
.sb-brand{padding:26px 22px 18px;border-bottom:1px solid var(--br)}
.sb-brand .b{font-family:"Syne",sans-serif;font-weight:800;font-size:1.15rem}
.sb-brand .b span{color:var(--gold)}
.sb-brand .s{font-size:.7rem;color:var(--mu);margin-top:2px}
.sb-nav{flex:1;padding:14px 0}
.sb-group{font-size:.65rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--mu);padding:10px 22px 4px}
.nav-item{display:flex;align-items:center;gap:11px;padding:11px 22px;cursor:pointer;font-size:.86rem;font-weight:600;color:var(--mu);position:relative;transition:background .2s,color .2s}
.nav-item:hover{background:rgba(201,168,76,.06);color:var(--tx)}
.nav-item.on{background:rgba(201,168,76,.1);color:var(--gold)}
.nav-item.on::before{content:"";position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--gold);border-radius:0 2px 2px 0}
.nav-item i{width:16px;text-align:center}
.sb-foot{padding:18px 22px;border-top:1px solid var(--br)}
.logout-btn{display:flex;align-items:center;gap:9px;cursor:pointer;color:var(--mu);font-size:.86rem;font-weight:600;background:none;border:none;font-family:"Space Grotesk",sans-serif;transition:color .2s}
.logout-btn:hover{color:var(--red)}

/* â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main-wrap{margin-left:250px;flex:1;min-height:100vh;display:flex;flex-direction:column}
.topbar{position:sticky;top:0;z-index:50;background:rgba(8,8,8,.9);backdrop-filter:blur(16px);border-bottom:1px solid var(--br);padding:15px 28px;display:flex;align-items:center;justify-content:space-between}
.topbar-title{font-family:"Syne",sans-serif;font-weight:700;font-size:1.05rem}
.topbar-right{display:flex;align-items:center;gap:12px}
.fb-badge{display:flex;align-items:center;gap:7px;background:rgba(201,168,76,.08);border:1px solid rgba(201,168,76,.2);padding:6px 14px;border-radius:50px;font-size:.76rem;font-weight:700;color:var(--gold)}
.view-btn{display:flex;align-items:center;gap:7px;background:transparent;border:1px solid rgba(201,168,76,.3);color:var(--gold);padding:7px 16px;border-radius:50px;font-size:.78rem;font-weight:700;cursor:pointer;text-decoration:none;transition:background .2s;font-family:"Space Grotesk",sans-serif}
.view-btn:hover{background:rgba(201,168,76,.1)}

/* â”€â”€ CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.content{padding:28px;flex:1}
.page{display:none}
.page.on{display:block;animation:fadeUp .4s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.page-header{margin-bottom:24px}
.page-header h2{font-size:1.7rem;font-weight:800;margin-bottom:4px}
.page-header p{color:var(--mu);font-size:.86rem}

/* â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:14px;margin-bottom:24px}
.stat-card{background:var(--s1);border:1px solid var(--br);border-radius:var(--r);padding:22px;transition:border-color .3s,transform .2s}
.stat-card:hover{border-color:rgba(201,168,76,.3);transform:translateY(-2px)}
.stat-card .ic{font-size:1.2rem;color:rgba(201,168,76,.35);margin-bottom:8px}
.stat-card .lbl{font-size:.68rem;color:var(--mu);text-transform:uppercase;letter-spacing:2px;margin-bottom:6px;font-weight:700}
.stat-card .num{font-family:"Syne",sans-serif;font-size:2rem;font-weight:800;background:linear-gradient(135deg,var(--gl),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1}

/* â”€â”€ PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.panel{background:var(--s1);border:1px solid var(--br);border-radius:var(--r);overflow:hidden;margin-bottom:20px}
.panel-head{padding:16px 22px;border-bottom:1px solid var(--br);display:flex;align-items:center;justify-content:space-between}
.panel-head h3{font-size:.95rem;font-weight:700}
.panel-body{padding:22px}

/* â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{display:inline-flex;align-items:center;gap:7px;padding:9px 20px;border-radius:50px;font-weight:700;font-size:.8rem;cursor:pointer;border:none;font-family:"Space Grotesk",sans-serif;transition:transform .2s,box-shadow .2s;letter-spacing:.03em}
.btn-gold{background:linear-gradient(135deg,var(--gl),var(--gold));color:#080808;box-shadow:0 4px 14px rgba(201,168,76,.25)}
.btn-gold:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(201,168,76,.35)}
.btn-outline{background:transparent;border:1px solid rgba(201,168,76,.35);color:var(--gold)}
.btn-outline:hover{background:rgba(201,168,76,.08)}
.btn-danger{background:transparent;border:1px solid rgba(232,87,87,.35);color:var(--red)}
.btn-danger:hover{background:rgba(232,87,87,.08)}
.btn-sm{padding:6px 14px;font-size:.74rem}
.btn:disabled{opacity:.5;cursor:not-allowed;transform:none !important}

/* â”€â”€ FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:.7rem;font-weight:700;color:var(--mu);text-transform:uppercase;letter-spacing:2px;margin-bottom:7px}
.form-group input,
.form-group textarea,
.form-group select{width:100%;padding:12px 15px;border:1px solid var(--br);border-radius:12px;background:var(--s2);color:var(--tx);font-family:"Space Grotesk",sans-serif;font-size:.9rem;outline:none;transition:border-color .3s}
.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus{border-color:rgba(201,168,76,.5);box-shadow:0 0 0 3px rgba(201,168,76,.08)}
.form-group input.error,
.form-group textarea.error,
.form-group select.error{border-color:var(--red) !important;box-shadow:0 0 0 3px rgba(232,87,87,.1) !important}
.form-group textarea{resize:vertical;min-height:85px}
.form-group select option{background:var(--s2)}
.char-count{font-size:.7rem;color:var(--mu);text-align:right;margin-top:3px}
.field-error{font-size:.72rem;color:var(--red);margin-top:4px;display:none}

/* â”€â”€ UPLOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.upload-area{border:2px dashed rgba(201,168,76,.25);border-radius:14px;padding:28px 18px;text-align:center;cursor:pointer;transition:border-color .3s,background .3s;background:var(--s2);position:relative}
.upload-area:hover,.upload-area.drag-over{border-color:var(--gold);background:rgba(201,168,76,.05)}
.upload-area input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.upload-area i{font-size:1.8rem;color:rgba(201,168,76,.4);margin-bottom:8px;display:block}
.upload-area p{color:var(--mu);font-size:.83rem}
.upload-area span{color:var(--gold);font-weight:700}
.preview-wrap{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.preview-img{position:relative;width:85px;height:65px;border-radius:9px;overflow:hidden;border:1px solid var(--br)}
.preview-img img{width:100%;height:100%;object-fit:cover}
.remove-img{position:absolute;top:3px;right:3px;width:18px;height:18px;background:rgba(0,0,0,.75);border:none;border-radius:50%;cursor:pointer;color:#fff;font-size:.55rem;display:flex;align-items:center;justify-content:center}

/* â”€â”€ TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.data-table{width:100%;border-collapse:collapse}
.data-table th{text-align:left;font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--mu);padding:9px 14px;border-bottom:1px solid var(--br)}
.data-table td{padding:12px 14px;border-bottom:1px solid rgba(201,168,76,.05);vertical-align:middle}
.data-table tr:last-child td{border-bottom:none}
.data-table tr:hover td{background:rgba(201,168,76,.02)}
.thumb{width:52px;height:40px;border-radius:7px;object-fit:cover;border:1px solid var(--br)}
.thumb-ph{width:52px;height:40px;border-radius:7px;background:var(--s2);border:1px solid var(--br);display:flex;align-items:center;justify-content:center;color:var(--mu);font-size:.65rem}
.tag-badge{display:inline-block;background:rgba(201,168,76,.1);color:var(--gold);font-size:.65rem;font-weight:700;padding:3px 9px;border-radius:50px;text-transform:uppercase;letter-spacing:1px}
.status-live{color:var(--grn);font-size:.76rem;font-weight:700;display:flex;align-items:center;gap:5px}
.status-live::before{content:"";width:5px;height:5px;border-radius:50%;background:var(--grn)}
.status-draft{color:var(--mu);font-size:.76rem;font-weight:700;display:flex;align-items:center;gap:5px}
.status-draft::before{content:"";width:5px;height:5px;border-radius:50%;background:var(--mu)}
.actions{display:flex;gap:7px;align-items:center}

/* â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:500;display:flex;align-items:center;justify-content:center;padding:18px;opacity:0;visibility:hidden;transition:opacity .3s,visibility .3s;backdrop-filter:blur(4px)}
.modal.open{opacity:1;visibility:visible}
.modal-box{background:var(--s1);border:1px solid var(--br);border-radius:22px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;transform:translateY(18px);transition:transform .3s}
.modal.open .modal-box{transform:translateY(0)}
.modal-head{padding:22px 26px;border-bottom:1px solid var(--br);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--s1);z-index:1}
.modal-head h3{font-size:1.1rem;font-weight:800}
.modal-close{background:none;border:none;color:var(--mu);cursor:pointer;font-size:1.1rem;padding:3px;transition:color .2s}
.modal-close:hover{color:var(--tx)}
.modal-body{padding:26px}
.modal-foot{padding:18px 26px;border-top:1px solid var(--br);display:flex;gap:10px;justify-content:flex-end}

/* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast-wrap{position:fixed;bottom:24px;right:24px;z-index:9000;display:flex;flex-direction:column;gap:9px}
.toast{background:var(--s1);border:1px solid var(--br);border-radius:13px;padding:13px 18px;display:flex;align-items:center;gap:11px;box-shadow:0 10px 36px rgba(0,0,0,.4);min-width:240px;animation:toastIn .3s ease;font-size:.86rem;font-weight:600}
.toast.ok{border-color:rgba(37,211,102,.3)}.toast.ok .ti{color:var(--grn)}
.toast.er{border-color:rgba(232,87,87,.3)}.toast.er .ti{color:var(--red)}
.toast.info{border-color:rgba(201,168,76,.3)}.toast.info .ti{color:var(--gold)}
@keyframes toastIn{from{opacity:0;transform:translateX(18px)}to{opacity:1;transform:translateX(0)}}

/* â”€â”€ STATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.empty-state{text-align:center;padding:36px 18px;color:var(--mu)}
.empty-state i{font-size:2rem;margin-bottom:10px;display:block;opacity:.25}
.loading-state{text-align:center;padding:28px;color:var(--mu);font-size:.9rem}
.loading-state i{color:var(--gold);margin-right:7px;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.dash-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}

/* â”€â”€ FILTER BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.filter-bar{display:flex;gap:9px;margin-bottom:18px;flex-wrap:wrap}

@media(max-width:768px){
  .sb{transform:translateX(-100%)}
  .main-wrap{margin-left:0}
  .form-grid{grid-template-columns:1fr}
  .content{padding:18px}
  .dash-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- â”€â”€ LOGIN OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="login">
  <div class="lb-box">
    <div class="lb-title">S.Saadi</div>
    <div class="lb-sub">Portfolio Admin Panel</div>
    <div class="lf">
      <label>Username</label>
      <input type="text" id="lu" placeholder="admin" autocomplete="username">
    </div>
    <div class="lf">
      <label>Password</label>
      <input type="password" id="lp" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
    </div>
    <button class="lbtn" onclick="doLogin()"><i class="fas fa-sign-in-alt"></i> Login</button>
    <div class="lerr" id="lerr">Wrong username or password</div>
    <div class="db-status">
      <div class="db-dot" id="dbd"></div>
      <span id="dbt">Connecting to Firebaseâ€¦</span>
    </div>
  </div>
</div>

<!-- â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<aside class="sb">
  <div class="sb-brand">
    <div class="b">S<span>.</span>Saadi</div>
    <div class="s">Admin Dashboard</div>
  </div>
  <nav class="sb-nav">
    <div class="sb-group">Main</div>
    <div class="nav-item on" onclick="gotoPage('dash',this)"><i class="fas fa-th-large"></i> Dashboard</div>
    <div class="nav-item" onclick="gotoPage('projects',this)"><i class="fas fa-folder-open"></i> All Projects</div>
    <div class="nav-item" onclick="gotoPage('add',this)"><i class="fas fa-plus-circle"></i> Add Project</div>
  </nav>
  <div class="sb-foot">
    <button class="logout-btn" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>
</aside>

<!-- â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="main-wrap">
  <div class="topbar">
    <span class="topbar-title" id="topbarTitle">Dashboard</span>
    <div class="topbar-right">
      <div class="fb-badge"><div class="db-dot" id="tbDot"></div><span id="tbText">Firebase</span></div>
      <a href="index.html" target="_blank" class="view-btn"><i class="fas fa-external-link-alt"></i> View Portfolio</a>
    </div>
  </div>

  <div class="content">

    <!-- DASHBOARD PAGE -->
    <div class="page on" id="pg-dash">
      <div class="page-header"><h2>Welcome back, Saadi ğŸ‘‹</h2><p>Your portfolio overview</p></div>
      <div class="stats-row">
        <div class="stat-card"><div class="ic"><i class="fas fa-folder"></i></div><div class="lbl">Total</div><div class="num" id="stTotal">â€”</div></div>
        <div class="stat-card"><div class="ic"><i class="fas fa-eye"></i></div><div class="lbl">Live</div><div class="num" id="stLive">â€”</div></div>
        <div class="stat-card"><div class="ic"><i class="fas fa-drafting-compass"></i></div><div class="lbl">Drafts</div><div class="num" id="stDraft">â€”</div></div>
      </div>
      <div class="dash-grid">
        <div class="panel">
          <div class="panel-head"><h3><i class="fas fa-clock" style="color:var(--gold);margin-right:7px"></i>Recent Projects</h3><button class="btn btn-outline btn-sm" onclick="gotoPage('add',null)"><i class="fas fa-plus"></i> Add</button></div>
          <div class="panel-body" id="recentProjs"><div class="loading-state"><i class="fas fa-spinner"></i>Loadingâ€¦</div></div>
        </div>
        <div class="panel">
          <div class="panel-head"><h3><i class="fas fa-fire" style="color:#f59e0b;margin-right:7px"></i>Firebase Status</h3></div>
          <div class="panel-body" id="fbStatusEl"><div class="loading-state"><i class="fas fa-spinner"></i>Checkingâ€¦</div></div>
        </div>
      </div>
    </div>

    <!-- ALL PROJECTS PAGE -->
    <div class="page" id="pg-projects">
      <div class="page-header" style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:12px">
        <div><h2>All Projects</h2><p>Manage your portfolio projects</p></div>
        <button class="btn btn-gold" onclick="gotoPage('add',null)"><i class="fas fa-plus"></i> Add New</button>
      </div>
      <div class="filter-bar">
        <button class="btn btn-gold btn-sm" onclick="applyFilter('all',this)" id="fAll">All</button>
        <button class="btn btn-outline btn-sm" onclick="applyFilter('live',this)">Live</button>
        <button class="btn btn-outline btn-sm" onclick="applyFilter('draft',this)">Draft</button>
      </div>
      <div class="panel"><div class="panel-body" style="padding:0;overflow-x:auto"><div id="projectTable"></div></div></div>
    </div>

    <!-- ADD PROJECT PAGE -->
    <div class="page" id="pg-add">
      <div class="page-header"><h2 id="formHeading">Add New Project</h2><p>Fill in details and save to Firestore</p></div>
      <div class="panel"><div class="panel-body">
        <div class="form-grid">
          <div class="form-group">
            <label>Title <span style="color:var(--red)">*</span></label>
            <input type="text" id="fTitle" placeholder="e.g. Spice Garden Restaurant" maxlength="60" oninput="updateCharCount(this,'cTitle',60)">
            <div class="char-count"><span id="cTitle">0</span>/60</div>
            <div class="field-error" id="errTitle">Title is required</div>
          </div>
          <div class="form-group">
            <label>Category <span style="color:var(--red)">*</span></label>
            <select id="fCategory">
              <option value="">Select categoryâ€¦</option>
              <option>Restaurant</option><option>Beauty Salon</option><option>Fitness</option>
              <option>Real Estate</option><option>Education</option><option>E-commerce</option>
              <option>Business</option><option>Healthcare</option><option>Other</option>
            </select>
            <div class="field-error" id="errCategory">Please select a category</div>
          </div>
        </div>
        <div class="form-group">
          <label>Description <span style="color:var(--red)">*</span></label>
          <textarea id="fDesc" placeholder="Describe the projectâ€¦" maxlength="220" oninput="updateCharCount(this,'cDesc',220)"></textarea>
          <div class="char-count"><span id="cDesc">0</span>/220</div>
          <div class="field-error" id="errDesc">Description is required</div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label>Live Demo URL</label>
            <input type="url" id="fUrl" placeholder="https://example.com">
          </div>
          <div class="form-group">
            <label>Status</label>
            <select id="fStatus"><option value="live">Live</option><option value="draft">Draft</option></select>
          </div>
        </div>
        <div class="form-group">
          <label>Screenshot (Max 1MB)</label>
          <div class="upload-area" id="uploadArea"
            ondragover="onDragOver(event)" ondragleave="onDragLeave()" ondrop="onDrop(event)">
            <input type="file" id="fileInput" accept="image/*" onchange="onFileSelect(event)">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Drag & drop or <span>click to upload</span></p>
            <p style="font-size:.73rem;margin-top:3px;opacity:.55">PNG, JPG, WEBP â€” Max 1MB</p>
          </div>
          <div class="preview-wrap" id="previewWrap"></div>
        </div>
        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:6px">
          <button class="btn btn-outline" onclick="cancelForm()">Cancel</button>
          <button class="btn btn-gold" id="saveBtn" onclick="saveProject()">
            <i class="fas fa-save"></i> Save to Firebase
          </button>
        </div>
      </div></div>
    </div>

  </div><!-- /content -->
</div><!-- /main-wrap -->

<!-- â”€â”€ EDIT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal" id="editModal">
  <div class="modal-box">
    <div class="modal-head">
      <h3>Edit Project</h3>
      <button class="modal-close" onclick="closeEdit()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group"><label>Title *</label><input type="text" id="eTitle" maxlength="60"></div>
        <div class="form-group">
          <label>Category *</label>
          <select id="eCategory">
            <option value="">Selectâ€¦</option>
            <option>Restaurant</option><option>Beauty Salon</option><option>Fitness</option>
            <option>Real Estate</option><option>Education</option><option>E-commerce</option>
            <option>Business</option><option>Healthcare</option><option>Other</option>
          </select>
        </div>
      </div>
      <div class="form-group"><label>Description *</label><textarea id="eDesc" maxlength="220"></textarea></div>
      <div class="form-grid">
        <div class="form-group"><label>Live Demo URL</label><input type="url" id="eUrl"></div>
        <div class="form-group"><label>Status</label><select id="eStatus"><option value="live">Live</option><option value="draft">Draft</option></select></div>
      </div>
      <div class="form-group">
        <label>Replace Screenshot (optional)</label>
        <input type="file" id="eFile" accept="image/*" onchange="onEditFileSelect(event)" style="background:var(--s2);padding:10px;border-radius:10px;border:1px solid var(--br);width:100%">
        <div id="eImgPreview" style="margin-top:8px"></div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-outline" onclick="closeEdit()">Cancel</button>
      <button class="btn btn-gold" id="updateBtn" onclick="updateProject()"><i class="fas fa-save"></i> Save</button>
    </div>
  </div>
</div>

<!-- â”€â”€ DELETE MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal" id="deleteModal">
  <div class="modal-box" style="max-width:420px">
    <div class="modal-head">
      <h3>Delete Project</h3>
      <button class="modal-close" onclick="closeDelete()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body">
      <p style="color:var(--mu);line-height:1.6">Are you sure you want to delete <strong id="deleteTitle" style="color:var(--tx)"></strong>? This action cannot be undone.</p>
    </div>
    <div class="modal-foot">
      <button class="btn btn-outline" onclick="closeDelete()">Cancel</button>
      <button class="btn btn-danger" onclick="confirmDelete()"><i class="fas fa-trash"></i> Delete</button>
    </div>
  </div>
</div>

<!-- â”€â”€ TOAST CONTAINER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="toast-wrap" id="toastWrap"></div>

<!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
     FIREBASE MODULE SCRIPT
     Responsibilities: WRITE-ONLY (addDoc, updateDoc, deleteDoc)
     Index page handles all reads for the public portfolio.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
<script type="module">

// â”€â”€ 1. FIREBASE INITIALIZATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import { initializeApp }    from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import {
  getFirestore,
  collection,
  addDoc,          // CREATE â€” admin only
  getDocs,         // READ   â€” used only inside admin, not exposed to public
  updateDoc,       // UPDATE â€” admin only
  deleteDoc,       // DELETE â€” admin only
  doc,
  orderBy,
  query,
  serverTimestamp  // â† always use server-side timestamp for accuracy
} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

// â”€â”€ Firebase config (same project, same DB â€” admin writes, index reads)
const firebaseConfig = {
  apiKey:            "AIzaSyC0fetGvPZs_mjbK3zIxB_NaiouuADfQtQ",
  authDomain:        "educentral-yz88l.firebaseapp.com",
  projectId:         "educentral-yz88l",
  storageBucket:     "educentral-yz88l.firebasestorage.app",
  messagingSenderId: "614628314650",
  appId:             "1:614628314650:web:cef50e2142ce11f1e50ba3"
};

console.log('[Admin] Initializing Firebase appâ€¦');
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);
console.log('[Admin] Firestore instance ready.');

// â”€â”€ 2. STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let allProjects  = [];
let activeFilter = 'all';
let editingId    = null;
let deleteId     = null;
let uploadedImage      = null; // base64 for new project
let editUploadedImage  = null; // base64 for edit modal

// Simple local-only auth (replace with Firebase Auth for production)
const ADMIN_USER = 'admin';
const ADMIN_PASS = 'saadi1234';

// â”€â”€ 3. FIREBASE CONNECTION CHECK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function checkFirebaseConnection() {
  console.log('[Admin] Checking Firestore connectionâ€¦');
  try {
    await getDocs(collection(db, 'projects'));
    console.log('[Admin] âœ… Firestore connected successfully.');
    setConnectionUI(true);
  } catch (err) {
    console.error('[Admin] âŒ Firestore connection failed:', err);
    setConnectionUI(false);
  }
}

function setConnectionUI(connected) {
  const loginDot  = document.getElementById('dbd');
  const loginText = document.getElementById('dbt');
  const topDot    = document.getElementById('tbDot');
  const topText   = document.getElementById('tbText');
  const statusEl  = document.getElementById('fbStatusEl');

  if (connected) {
    loginDot.className  = 'db-dot ok';
    loginText.textContent = 'Firebase Connected âœ“';
    topDot.className    = 'db-dot ok';
    topText.textContent = 'Firebase Live';
    statusEl.innerHTML  = `
      <div style="display:flex;align-items:center;gap:12px;padding:14px;background:rgba(37,211,102,.07);border:1px solid rgba(37,211,102,.2);border-radius:12px">
        <i class="fas fa-check-circle" style="color:var(--grn);font-size:1.3rem"></i>
        <div>
          <div style="font-weight:700;color:var(--grn)">Connected!</div>
          <div style="font-size:.82rem;color:var(--mu);margin-top:2px">Projects you save here appear live on the portfolio index page.</div>
        </div>
      </div>`;
  } else {
    loginDot.className  = 'db-dot err';
    loginText.textContent = 'Firebase Error â€” Check Console';
    topDot.className    = 'db-dot err';
    topText.textContent = 'Firebase Error';
    statusEl.innerHTML  = `
      <div style="display:flex;align-items:center;gap:12px;padding:14px;background:rgba(232,87,87,.07);border:1px solid rgba(232,87,87,.2);border-radius:12px">
        <i class="fas fa-times-circle" style="color:var(--red);font-size:1.3rem"></i>
        <div>
          <div style="font-weight:700;color:var(--red)">Connection Error</div>
          <div style="font-size:.82rem;color:var(--mu);margin-top:2px">Check Firestore rules â€” allow read/write in test mode.</div>
        </div>
      </div>`;
  }
}

checkFirebaseConnection();

// â”€â”€ 4. AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.doLogin = function() {
  const username = document.getElementById('lu').value.trim();
  const password = document.getElementById('lp').value;
  console.log('[Admin] Login attempt for user:', username);

  if (username === ADMIN_USER && password === ADMIN_PASS) {
    console.log('[Admin] âœ… Login successful.');
    document.getElementById('login').classList.add('hide');
    showToast('Welcome back, Saadi! ğŸ‘‹', 'ok');
    loadDashboard();
  } else {
    console.warn('[Admin] âŒ Login failed â€” wrong credentials.');
    document.getElementById('lerr').style.display = 'block';
    const pwInput = document.getElementById('lp');
    pwInput.style.borderColor = 'var(--red)';
    setTimeout(() => { pwInput.style.borderColor = ''; }, 2000);
  }
};

window.doLogout = function() {
  console.log('[Admin] Logging out.');
  document.getElementById('login').classList.remove('hide');
  document.getElementById('lu').value = '';
  document.getElementById('lp').value = '';
};

document.getElementById('lp').addEventListener('keydown', e => {
  if (e.key === 'Enter') window.doLogin();
});

// â”€â”€ 5. NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.gotoPage = function(pageId, navEl) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('on'));
  document.getElementById('pg-' + pageId).classList.add('on');
  if (navEl) navEl.classList.add('on');

  const titles = { dash: 'Dashboard', projects: 'All Projects', add: 'Add Project' };
  document.getElementById('topbarTitle').textContent = titles[pageId] || pageId;

  if (pageId === 'projects') loadProjectsTable();
  if (pageId === 'dash')     loadDashboard();
  if (pageId === 'add')      resetAddForm();
};

// â”€â”€ 6. READ (admin-internal only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Note: This read is only used inside the admin panel for listing & editing.
// The public index.html has its own independent read logic.
async function fetchAllProjects() {
  console.log('[Admin] Fetching all projects from Firestoreâ€¦');
  try {
    const q    = query(collection(db, 'projects'), orderBy('createdAt', 'desc'));
    const snap = await getDocs(q);
    allProjects = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    console.log(`[Admin] âœ… Fetched ${allProjects.length} projects.`);
    return allProjects;
  } catch (err) {
    console.error('[Admin] âŒ Failed to fetch projects:', err);
    showToast('Failed to load projects: ' + err.message, 'er');
    return [];
  }
}

// â”€â”€ 7. DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadDashboard() {
  document.getElementById('stTotal').textContent = 'â€¦';
  document.getElementById('stLive').textContent  = 'â€¦';
  document.getElementById('stDraft').textContent = 'â€¦';
  document.getElementById('recentProjs').innerHTML = '<div class="loading-state"><i class="fas fa-spinner"></i>Loadingâ€¦</div>';

  const projects = await fetchAllProjects();

  document.getElementById('stTotal').textContent = projects.length;
  document.getElementById('stLive').textContent  = projects.filter(p => p.status === 'live').length;
  document.getElementById('stDraft').textContent = projects.filter(p => p.status === 'draft').length;

  const recentEl  = document.getElementById('recentProjs');
  const recent    = projects.slice(0, 4);

  if (!recent.length) {
    recentEl.innerHTML = '<div class="empty-state"><i class="fas fa-folder-open"></i><p>No projects yet</p></div>';
    return;
  }

  recentEl.innerHTML = recent.map(p => `
    <div style="display:flex;align-items:center;gap:12px;padding:9px 0;border-bottom:1px solid rgba(201,168,76,.05)">
      ${p.image
        ? `<img src="${p.image}" style="width:48px;height:37px;border-radius:7px;object-fit:cover;border:1px solid var(--br);flex-shrink:0">`
        : `<div style="width:48px;height:37px;border-radius:7px;background:var(--s2);border:1px solid var(--br);display:flex;align-items:center;justify-content:center;flex-shrink:0"><i class="fas fa-image" style="color:var(--mu)"></i></div>`
      }
      <div style="flex:1;min-width:0">
        <div style="font-weight:600;font-size:.87rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${escapeHtml(p.title)}</div>
        <div style="color:var(--mu);font-size:.73rem;margin-top:1px">${escapeHtml(p.category)}</div>
      </div>
      <div class="${p.status === 'live' ? 'status-live' : 'status-draft'}">${p.status === 'live' ? 'Live' : 'Draft'}</div>
    </div>`).join('');
}

// â”€â”€ 8. PROJECTS TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadProjectsTable(filter) {
  filter = filter || activeFilter;
  const tableEl = document.getElementById('projectTable');
  tableEl.innerHTML = '<div class="loading-state"><i class="fas fa-spinner"></i>Loadingâ€¦</div>';

  let projects = await fetchAllProjects();
  if (filter !== 'all') projects = projects.filter(p => p.status === filter);

  if (!projects.length) {
    tableEl.innerHTML = '<div class="empty-state" style="padding:36px"><i class="fas fa-folder-open"></i><p>No projects found</p></div>';
    return;
  }

  tableEl.innerHTML = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Screenshot</th><th>Title</th><th>Category</th><th>Status</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${projects.map(p => `
        <tr>
          <td>${p.image
            ? `<img src="${p.image}" class="thumb">`
            : `<div class="thumb-ph"><i class="fas fa-image"></i></div>`
          }</td>
          <td style="max-width:180px">
            <div style="font-weight:600;font-size:.86rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${escapeHtml(p.title)}</div>
            <div style="color:var(--mu);font-size:.73rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:170px;margin-top:1px">${escapeHtml(p.desc)}</div>
          </td>
          <td><span class="tag-badge">${escapeHtml(p.category)}</span></td>
          <td><div class="${p.status === 'live' ? 'status-live' : 'status-draft'}">${p.status === 'live' ? 'Live' : 'Draft'}</div></td>
          <td><div class="actions">
            ${p.url ? `<a href="${p.url}" target="_blank" class="btn btn-outline btn-sm"><i class="fas fa-external-link-alt"></i></a>` : ''}
            <button class="btn btn-outline btn-sm" onclick="openEdit('${p.id}')"><i class="fas fa-pen"></i></button>
            <button class="btn btn-danger btn-sm" onclick="openDelete('${p.id}','${escapeAttr(p.title)}')"><i class="fas fa-trash"></i></button>
          </div></td>
        </tr>`).join('')}
      </tbody>
    </table>`;
}

window.applyFilter = function(filter, btn) {
  activeFilter = filter;
  document.querySelectorAll('.filter-bar .btn').forEach(b => {
    b.className = 'btn btn-outline btn-sm';
  });
  btn.className = 'btn btn-gold btn-sm';
  loadProjectsTable(filter);
};

// â”€â”€ 9. ADD PROJECT â€” FORM VALIDATION + addDoc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// This is the CORE write operation of the admin page.
// Public index.html never writes â€” it only calls getDocs.

window.saveProject = async function() {
  const title    = document.getElementById('fTitle').value.trim();
  const category = document.getElementById('fCategory').value;
  const desc     = document.getElementById('fDesc').value.trim();
  const url      = document.getElementById('fUrl').value.trim();
  const status   = document.getElementById('fStatus').value;

  // â”€â”€ Form validation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let isValid = true;

  if (!title) {
    showFieldError('fTitle', 'errTitle', true);
    isValid = false;
  } else {
    showFieldError('fTitle', 'errTitle', false);
  }

  if (!category) {
    showFieldError('fCategory', 'errCategory', true);
    isValid = false;
  } else {
    showFieldError('fCategory', 'errCategory', false);
  }

  if (!desc) {
    showFieldError('fDesc', 'errDesc', true);
    isValid = false;
  } else {
    showFieldError('fDesc', 'errDesc', false);
  }

  if (!isValid) {
    showToast('Please fill in all required fields', 'er');
    return;
  }

  // â”€â”€ Disable button while saving â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const saveBtn = document.getElementById('saveBtn');
  saveBtn.disabled = true;
  saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Savingâ€¦';

  // â”€â”€ Build document object â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const projectData = {
    title,
    category,
    desc,
    url:       url || null,
    status,
    image:     uploadedImage || null,
    createdAt: serverTimestamp(),  // â† server-side timestamp (not Date.now())
    updatedAt: serverTimestamp()
  };

  console.log('[Admin] Attempting addDoc with data:', { title, category, status });

  // â”€â”€ addDoc: creates a new document with auto-generated ID â”€
  try {
    const docRef = await addDoc(collection(db, 'projects'), projectData);
    console.log('[Admin] âœ… Project saved. Document ID:', docRef.id);

    showToast('Project saved to Firebase! âœ“', 'ok');
    resetAddForm();

    // Navigate back to All Projects to confirm save
    gotoPage('projects', document.querySelectorAll('.nav-item')[1]);

  } catch (err) {
    console.error('[Admin] âŒ addDoc failed:', err);
    showToast('Save failed: ' + err.message, 'er');
  } finally {
    saveBtn.disabled = false;
    saveBtn.innerHTML = '<i class="fas fa-save"></i> Save to Firebase';
  }
};

function showFieldError(inputId, errorId, show) {
  const input = document.getElementById(inputId);
  const errEl = document.getElementById(errorId);
  if (show) {
    input.classList.add('error');
    errEl.style.display = 'block';
  } else {
    input.classList.remove('error');
    errEl.style.display = 'none';
  }
}

function resetAddForm() {
  ['fTitle','fDesc','fUrl'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('fCategory').value = '';
  document.getElementById('fStatus').value = 'live';
  document.getElementById('previewWrap').innerHTML = '';
  document.getElementById('fileInput').value = '';
  document.getElementById('cTitle').textContent = '0';
  document.getElementById('cDesc').textContent = '0';
  document.getElementById('formHeading').textContent = 'Add New Project';
  // Clear field errors
  ['errTitle','errCategory','errDesc'].forEach(id => {
    document.getElementById(id).style.display = 'none';
  });
  ['fTitle','fCategory','fDesc'].forEach(id => {
    document.getElementById(id).classList.remove('error');
  });
  uploadedImage = null;
}

window.cancelForm = () => {
  resetAddForm();
  gotoPage('projects', document.querySelectorAll('.nav-item')[1]);
};

// â”€â”€ 10. IMAGE UPLOAD (base64, max 1MB) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function readImageAsBase64(file, callback) {
  if (file.size > 1024 * 1024) {
    showToast('Max image size is 1MB', 'er');
    console.warn('[Admin] Image rejected â€” too large:', file.size, 'bytes');
    return;
  }
  const reader = new FileReader();
  reader.onload = e => {
    console.log('[Admin] Image read as base64, size:', Math.round(file.size / 1024), 'KB');
    callback(e.target.result);
  };
  reader.readAsDataURL(file);
}

window.onFileSelect = e => {
  const file = e.target.files[0];
  if (!file) return;
  readImageAsBase64(file, data => {
    uploadedImage = data;
    document.getElementById('previewWrap').innerHTML =
      `<div class="preview-img">
        <img src="${data}">
        <button class="remove-img" onclick="removeImage()"><i class="fas fa-times"></i></button>
      </div>`;
  });
};

window.removeImage = () => {
  uploadedImage = null;
  document.getElementById('previewWrap').innerHTML = '';
  document.getElementById('fileInput').value = '';
  console.log('[Admin] Image removed from form.');
};

window.onDragOver  = e => { e.preventDefault(); document.getElementById('uploadArea').classList.add('drag-over'); };
window.onDragLeave = () => document.getElementById('uploadArea').classList.remove('drag-over');
window.onDrop      = e => {
  e.preventDefault();
  window.onDragLeave();
  const file = e.dataTransfer.files[0];
  if (!file || !file.type.startsWith('image/')) { showToast('Please drop an image file', 'er'); return; }
  readImageAsBase64(file, data => {
    uploadedImage = data;
    document.getElementById('previewWrap').innerHTML =
      `<div class="preview-img">
        <img src="${data}">
        <button class="remove-img" onclick="removeImage()"><i class="fas fa-times"></i></button>
      </div>`;
  });
};

// â”€â”€ 11. EDIT / updateDoc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openEdit = function(id) {
  const p = allProjects.find(x => x.id === id);
  if (!p) { console.error('[Admin] Project not found for edit:', id); return; }

  editingId = id;
  editUploadedImage = p.image || null;

  document.getElementById('eTitle').value    = p.title;
  document.getElementById('eCategory').value = p.category;
  document.getElementById('eDesc').value     = p.desc;
  document.getElementById('eUrl').value      = p.url || '';
  document.getElementById('eStatus').value   = p.status;
  document.getElementById('eImgPreview').innerHTML = p.image
    ? `<img src="${p.image}" style="width:80px;height:60px;object-fit:cover;border-radius:8px;border:1px solid var(--br)">`
    : '';
  document.getElementById('editModal').classList.add('open');
  console.log('[Admin] Opened edit modal for project:', id);
};

window.onEditFileSelect = e => {
  const file = e.target.files[0];
  if (!file) return;
  readImageAsBase64(file, data => {
    editUploadedImage = data;
    document.getElementById('eImgPreview').innerHTML =
      `<img src="${data}" style="width:80px;height:60px;object-fit:cover;border-radius:8px;border:1px solid var(--br)">`;
  });
};

window.updateProject = async function() {
  const title    = document.getElementById('eTitle').value.trim();
  const category = document.getElementById('eCategory').value;
  const desc     = document.getElementById('eDesc').value.trim();
  const url      = document.getElementById('eUrl').value.trim();
  const status   = document.getElementById('eStatus').value;

  if (!title)    { showToast('Title is required', 'er'); return; }
  if (!category) { showToast('Please select a category', 'er'); return; }
  if (!desc)     { showToast('Description is required', 'er'); return; }

  const updateBtn = document.getElementById('updateBtn');
  updateBtn.disabled = true;
  updateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

  const updateData = {
    title,
    category,
    desc,
    url:       url || null,
    status,
    image:     editUploadedImage || null,
    updatedAt: serverTimestamp()
  };

  console.log('[Admin] Updating project:', editingId, updateData.title);

  try {
    await updateDoc(doc(db, 'projects', editingId), updateData);
    console.log('[Admin] âœ… Project updated:', editingId);
    showToast('Updated successfully! âœ“', 'ok');
    closeEdit();
    loadProjectsTable();
    loadDashboard();
  } catch (err) {
    console.error('[Admin] âŒ updateDoc failed:', err);
    showToast('Update failed: ' + err.message, 'er');
  } finally {
    updateBtn.disabled = false;
    updateBtn.innerHTML = '<i class="fas fa-save"></i> Save';
  }
};

window.closeEdit = () => {
  document.getElementById('editModal').classList.remove('open');
  document.getElementById('eFile').value = '';
  editingId = null;
  editUploadedImage = null;
};

// â”€â”€ 12. DELETE / deleteDoc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openDelete = (id, name) => {
  deleteId = id;
  document.getElementById('deleteTitle').textContent = name;
  document.getElementById('deleteModal').classList.add('open');
  console.log('[Admin] Opened delete confirm for:', id, name);
};

window.closeDelete = () => {
  document.getElementById('deleteModal').classList.remove('open');
  deleteId = null;
};

window.confirmDelete = async function() {
  if (!deleteId) return;
  console.log('[Admin] Deleting project:', deleteId);
  try {
    await deleteDoc(doc(db, 'projects', deleteId));
    console.log('[Admin] âœ… Project deleted:', deleteId);
    showToast('Project deleted', 'info');
    closeDelete();
    loadProjectsTable();
    loadDashboard();
  } catch (err) {
    console.error('[Admin] âŒ deleteDoc failed:', err);
    showToast('Delete failed: ' + err.message, 'er');
  }
};

// â”€â”€ 13. TOAST NOTIFICATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.showToast = function(message, type = 'info') {
  const icons = { ok: 'fa-check-circle', er: 'fa-exclamation-circle', info: 'fa-info-circle' };
  const wrap  = document.getElementById('toastWrap');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `<i class="fas ${icons[type] || icons.info} ti"></i><span>${message}</span>`;
  wrap.appendChild(toast);
  setTimeout(() => {
    toast.style.opacity   = '0';
    toast.style.transform = 'translateX(18px)';
    toast.style.transition = '.3s';
    setTimeout(() => toast.remove(), 350);
  }, 3500);
};

// â”€â”€ 14. UTILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function escapeHtml(str) {
  if (!str) return '';
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function escapeAttr(str) {
  if (!str) return '';
  return str.replace(/'/g,'&#39;').replace(/"/g,'&quot;');
}

window.updateCharCount = function(el, counterId, max) {
  document.getElementById(counterId).textContent = el.value.length;
};

// â”€â”€ Close modals on backdrop click â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('editModal').addEventListener('click', e => {
  if (e.target === document.getElementById('editModal')) closeEdit();
});
document.getElementById('deleteModal').addEventListener('click', e => {
  if (e.target === document.getElementById('deleteModal')) closeDelete();
});

</script>
</body>
</html>
