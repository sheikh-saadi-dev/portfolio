<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel â€” Sheikh Saadi Portfolio</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
/* â”€â”€â”€ FIREBASE CONFIG NOTICE â”€â”€â”€ */
#configBanner{position:fixed;top:0;left:0;width:100%;z-index:99999;background:#e8572a;color:#fff;padding:12px 24px;font-family:'Space Grotesk',sans-serif;font-size:.9rem;font-weight:600;text-align:center;display:flex;align-items:center;justify-content:center;gap:12px}
#configBanner a{color:#fff;font-weight:700;text-decoration:underline;cursor:pointer}
#configBanner.hidden{display:none}

:root{--gold:#c9a84c;--gold-light:#e8c87a;--gold-dark:#9a7a2e;--ink:#080808;--surface:#0f0f0f;--surface2:#161616;--surface3:#1e1e1e;--muted:#777;--border:rgba(201,168,76,0.15);--text:#e8e8e8;--danger:#e85757;--success:#25d366;--radius:14px}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:'Space Grotesk',sans-serif;background:var(--ink);color:var(--text);min-height:100vh;display:flex;padding-top:0}
body.config-shown{padding-top:48px}
h1,h2,h3,h4{font-family:'Syne',sans-serif}

/* LOGIN */
#loginScreen{position:fixed;inset:0;z-index:9999;background:var(--ink);display:flex;align-items:center;justify-content:center;transition:opacity .5s,visibility .5s}
#loginScreen.hide{opacity:0;visibility:hidden;pointer-events:none}
.login-box{width:100%;max-width:420px;padding:48px 40px;background:var(--surface);border:1px solid var(--border);border-radius:24px;box-shadow:0 30px 80px rgba(0,0,0,0.6);text-align:center;animation:fadeUp .6s ease}
.login-logo{font-family:'Syne',sans-serif;font-weight:800;font-size:2rem;margin-bottom:8px;background:linear-gradient(135deg,var(--gold-light),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.login-sub{color:var(--muted);font-size:.88rem;margin-bottom:36px}
.login-field{margin-bottom:18px;text-align:left}
.login-field label{display:block;font-size:.75rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:8px}
.login-field input{width:100%;padding:14px 18px;border:1px solid var(--border);border-radius:12px;background:var(--surface2);color:var(--text);font-family:'Space Grotesk',sans-serif;font-size:.95rem;outline:none;transition:border-color .3s,box-shadow .3s}
.login-field input:focus{border-color:rgba(201,168,76,0.5);box-shadow:0 0 0 3px rgba(201,168,76,0.08)}
.login-btn{width:100%;padding:15px;margin-top:8px;background:linear-gradient(135deg,var(--gold-light),var(--gold));color:var(--ink);border:none;border-radius:50px;font-weight:700;font-size:1rem;cursor:pointer;font-family:'Space Grotesk',sans-serif;transition:transform .2s,box-shadow .2s;box-shadow:0 6px 20px rgba(201,168,76,0.3)}
.login-btn:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(201,168,76,0.4)}
.login-error{color:var(--danger);font-size:.85rem;margin-top:12px;display:none}
.db-status{margin-top:14px;font-size:.78rem;display:flex;align-items:center;justify-content:center;gap:6px}
.db-dot{width:8px;height:8px;border-radius:50%;background:var(--muted)}
.db-dot.connected{background:var(--success);animation:pulse 2s infinite}
.db-dot.error{background:var(--danger)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* SIDEBAR */
.sidebar{width:260px;min-height:100vh;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100;transition:transform .3s}
.sidebar-logo{padding:28px 24px 20px;border-bottom:1px solid var(--border)}
.sidebar-logo .brand{font-family:'Syne',sans-serif;font-weight:800;font-size:1.2rem}
.sidebar-logo .brand span{color:var(--gold)}
.sidebar-logo .sub{font-size:.72rem;color:var(--muted);margin-top:2px;letter-spacing:.05em}
.sidebar-nav{flex:1;padding:16px 0;overflow-y:auto}
.nav-group-label{font-size:.68rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--muted);padding:12px 24px 6px}
.nav-item{display:flex;align-items:center;gap:12px;padding:12px 24px;cursor:pointer;transition:background .2s,color .2s;font-size:.88rem;font-weight:600;color:var(--muted);position:relative}
.nav-item:hover{background:rgba(201,168,76,0.06);color:var(--text)}
.nav-item.active{background:rgba(201,168,76,0.1);color:var(--gold)}
.nav-item.active::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--gold);border-radius:0 2px 2px 0}
.nav-item i{width:18px;text-align:center}
.sidebar-footer{padding:20px 24px;border-top:1px solid var(--border)}
.logout-btn{display:flex;align-items:center;gap:10px;cursor:pointer;color:var(--muted);font-size:.88rem;font-weight:600;transition:color .2s;background:none;border:none;font-family:'Space Grotesk',sans-serif}
.logout-btn:hover{color:var(--danger)}

/* MAIN */
.main{margin-left:260px;flex:1;min-height:100vh;display:flex;flex-direction:column}
.topbar{position:sticky;top:0;z-index:50;background:rgba(8,8,8,0.9);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:16px 32px;display:flex;align-items:center;justify-content:space-between}
.topbar-title{font-family:'Syne',sans-serif;font-weight:700;font-size:1.1rem}
.topbar-right{display:flex;align-items:center;gap:14px}
.topbar-badge{display:flex;align-items:center;gap:8px;background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);padding:7px 16px;border-radius:50px;font-size:.78rem;color:var(--gold);font-weight:700;letter-spacing:.04em}
.view-btn{display:flex;align-items:center;gap:8px;background:transparent;border:1px solid rgba(201,168,76,0.3);color:var(--gold);padding:8px 18px;border-radius:50px;font-size:.8rem;font-weight:700;cursor:pointer;text-decoration:none;transition:background .2s;font-family:'Space Grotesk',sans-serif}
.view-btn:hover{background:rgba(201,168,76,0.1)}
.mob-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.3rem;cursor:pointer;padding:4px}
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:99}

/* CONTENT */
.content{padding:32px;flex:1}
.page{display:none}
.page.active{display:block;animation:fadeUp .4s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.page-header{margin-bottom:28px;display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:14px}
.page-header-text h2{font-size:1.8rem;font-weight:800;margin-bottom:6px}
.page-header-text p{color:var(--muted);font-size:.88rem}

/* STATS */
.stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:16px;margin-bottom:28px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;transition:border-color .3s,transform .2s}
.stat-card:hover{border-color:rgba(201,168,76,0.3);transform:translateY(-2px)}
.sc-icon{font-size:1.3rem;color:rgba(201,168,76,0.35);margin-bottom:10px}
.sc-label{font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:8px;font-weight:700}
.sc-num{font-family:'Syne',sans-serif;font-size:2.2rem;font-weight:800;background:linear-gradient(135deg,var(--gold-light),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1}

/* PANEL */
.panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-bottom:24px}
.panel-head{padding:18px 24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.panel-head h3{font-size:1rem;font-weight:700}
.panel-body{padding:24px}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 22px;border-radius:50px;font-weight:700;font-size:.82rem;cursor:pointer;border:none;font-family:'Space Grotesk',sans-serif;transition:transform .2s,box-shadow .2s,opacity .2s;letter-spacing:.03em}
.btn-gold{background:linear-gradient(135deg,var(--gold-light),var(--gold));color:var(--ink);box-shadow:0 4px 16px rgba(201,168,76,0.25)}
.btn-gold:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(201,168,76,0.35)}
.btn-outline{background:transparent;border:1px solid rgba(201,168,76,0.35);color:var(--gold)}
.btn-outline:hover{background:rgba(201,168,76,0.08)}
.btn-danger{background:transparent;border:1px solid rgba(232,87,87,0.35);color:var(--danger)}
.btn-danger:hover{background:rgba(232,87,87,0.08)}
.btn-sm{padding:7px 16px;font-size:.75rem}
.btn:disabled{opacity:.5;cursor:not-allowed;transform:none}

/* FORM */
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.form-group{margin-bottom:18px}
.form-group label{display:block;font-size:.72rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:8px}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:13px 16px;border:1px solid var(--border);border-radius:12px;background:var(--surface2);color:var(--text);font-family:'Space Grotesk',sans-serif;font-size:.92rem;outline:none;transition:border-color .3s,box-shadow .3s}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:rgba(201,168,76,0.5);box-shadow:0 0 0 3px rgba(201,168,76,0.08)}
.form-group textarea{resize:vertical;min-height:90px}
.form-group select option{background:var(--surface2)}
.char-count{font-size:.72rem;color:var(--muted);text-align:right;margin-top:4px}

/* IMAGE UPLOAD */
.img-upload-area{border:2px dashed rgba(201,168,76,0.25);border-radius:14px;padding:32px 20px;text-align:center;cursor:pointer;transition:border-color .3s,background .3s;background:var(--surface2);position:relative}
.img-upload-area:hover,.img-upload-area.dragover{border-color:var(--gold);background:rgba(201,168,76,0.05)}
.img-upload-area input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.img-upload-area i{font-size:2rem;color:rgba(201,168,76,0.4);margin-bottom:10px;display:block}
.img-upload-area p{color:var(--muted);font-size:.85rem}
.img-upload-area span{color:var(--gold);font-weight:700}
.img-preview-wrap{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
.img-preview-item{position:relative;width:90px;height:70px;border-radius:10px;overflow:hidden;border:1px solid var(--border)}
.img-preview-item img{width:100%;height:100%;object-fit:cover}
.remove-img{position:absolute;top:4px;right:4px;width:20px;height:20px;background:rgba(0,0,0,0.7);border:none;border-radius:50%;cursor:pointer;color:#fff;font-size:.6rem;display:flex;align-items:center;justify-content:center}

/* TABLE */
.proj-table{width:100%;border-collapse:collapse}
.proj-table th{text-align:left;font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--muted);padding:10px 16px;border-bottom:1px solid var(--border)}
.proj-table td{padding:14px 16px;border-bottom:1px solid rgba(201,168,76,0.06);vertical-align:middle}
.proj-table tr:last-child td{border-bottom:none}
.proj-table tr:hover td{background:rgba(201,168,76,0.025)}
.proj-thumb{width:56px;height:42px;border-radius:8px;object-fit:cover;border:1px solid var(--border)}
.proj-thumb-ph{width:56px;height:42px;border-radius:8px;background:var(--surface2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:.7rem}
.tag-badge{display:inline-block;background:rgba(201,168,76,0.1);color:var(--gold);font-size:.68rem;font-weight:700;padding:3px 10px;border-radius:50px;text-transform:uppercase;letter-spacing:1px}
.status-live,.status-draft{font-size:.78rem;font-weight:700;display:flex;align-items:center;gap:6px}
.status-live{color:var(--success)}.status-live::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--success)}
.status-draft{color:var(--muted)}.status-draft::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--muted)}
.actions-cell{display:flex;gap:8px;align-items:center}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:500;display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;visibility:hidden;transition:opacity .3s,visibility .3s;backdrop-filter:blur(4px)}
.modal-overlay.open{opacity:1;visibility:visible}
.modal-box{background:var(--surface);border:1px solid var(--border);border-radius:24px;width:100%;max-width:640px;max-height:90vh;overflow-y:auto;transform:translateY(20px);transition:transform .3s}
.modal-overlay.open .modal-box{transform:translateY(0)}
.modal-head{padding:24px 28px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--surface);z-index:1}
.modal-head h3{font-size:1.2rem;font-weight:800}
.modal-close{background:none;border:none;color:var(--muted);cursor:pointer;font-size:1.2rem;padding:4px;transition:color .2s}
.modal-close:hover{color:var(--text)}
.modal-body{padding:28px}
.modal-footer{padding:20px 28px;border-top:1px solid var(--border);display:flex;gap:12px;justify-content:flex-end}

/* FIREBASE CONFIG PAGE */
.config-box{background:var(--surface2);border:1px solid rgba(201,168,76,0.3);border-radius:16px;padding:28px;margin-bottom:20px}
.config-box h4{font-size:1rem;font-weight:700;margin-bottom:6px;color:var(--gold)}
.config-box p{font-size:.88rem;color:var(--muted);line-height:1.6;margin-bottom:16px}
.step-num{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;background:rgba(201,168,76,0.15);color:var(--gold);font-weight:800;font-size:.85rem;margin-right:8px;flex-shrink:0}
.step-row{display:flex;align-items:flex-start;gap:0;margin-bottom:14px}
.config-textarea{width:100%;padding:14px;border:1px solid var(--border);border-radius:12px;background:var(--surface3);color:var(--text);font-family:monospace;font-size:.82rem;outline:none;resize:vertical;min-height:180px;transition:border-color .3s}
.config-textarea:focus{border-color:rgba(201,168,76,0.5)}
.code-block{background:var(--surface3);border:1px solid var(--border);border-radius:10px;padding:14px 18px;font-family:monospace;font-size:.82rem;color:var(--gold-light);overflow-x:auto;margin:12px 0;line-height:1.6}

/* TOAST */
.toast-wrap{position:fixed;bottom:28px;right:28px;z-index:9000;display:flex;flex-direction:column;gap:10px}
.toast{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px 20px;display:flex;align-items:center;gap:12px;box-shadow:0 12px 40px rgba(0,0,0,0.4);min-width:260px;animation:toastIn .35s ease;font-size:.88rem;font-weight:600}
.toast.success{border-color:rgba(37,211,102,0.3)}.toast.success .t-icon{color:var(--success)}
.toast.error{border-color:rgba(232,87,87,0.3)}.toast.error .t-icon{color:var(--danger)}
.toast.info{border-color:rgba(201,168,76,0.3)}.toast.info .t-icon{color:var(--gold)}
@keyframes toastIn{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}

.empty-state{text-align:center;padding:48px 20px;color:var(--muted)}
.empty-state i{font-size:2.5rem;margin-bottom:14px;display:block;opacity:.3}
.dash-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.loading-row{text-align:center;padding:32px;color:var(--muted);font-size:.9rem}
.loading-row i{animation:spin 1s linear infinite;margin-right:8px;color:var(--gold)}
@keyframes spin{to{transform:rotate(360deg)}}

@media(max-width:768px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}.sidebar-overlay.show{display:block}.main{margin-left:0}.mob-toggle{display:block}.form-row{grid-template-columns:1fr}.content{padding:20px}.dash-grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<!-- CONFIG BANNER -->
<div id="configBanner">
  <i class="fas fa-exclamation-triangle"></i>
  Firebase not configured â€” projects won't save permanently.
  <a onclick="showPage('firebase',null)">Click here to set up Firebase â†’</a>
</div>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">S.Saadi</div>
    <div class="login-sub">Portfolio Admin Panel</div>
    <div class="login-field">
      <label>Username</label>
      <input type="text" id="loginUser" placeholder="admin" autocomplete="username">
    </div>
    <div class="login-field">
      <label>Password</label>
      <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()">
    </div>
    <button class="login-btn" onclick="doLogin()"><i class="fas fa-sign-in-alt"></i> Login</button>
    <div class="login-error" id="loginError">Invalid username or password</div>
    <div class="db-status">
      <div class="db-dot" id="dbDot"></div>
      <span id="dbStatusText">Checking Firebase...</span>
    </div>
  </div>
</div>

<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

<aside class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="brand">S<span>.</span>Saadi</div>
    <div class="sub">Admin Dashboard</div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-group-label">Main</div>
    <div class="nav-item active" onclick="showPage('dashboard',this)"><i class="fas fa-th-large"></i> Dashboard</div>
    <div class="nav-item" onclick="showPage('projects',this)"><i class="fas fa-folder-open"></i> Projects</div>
    <div class="nav-item" onclick="showPage('add-project',this)"><i class="fas fa-plus-circle"></i> Add Project</div>
    <div class="nav-group-label" style="margin-top:12px">Settings</div>
    <div class="nav-item" onclick="showPage('firebase',this)"><i class="fas fa-fire" style="color:#f59e0b"></i> Firebase Setup</div>
    <div class="nav-item" onclick="showPage('security',this)"><i class="fas fa-lock"></i> Security</div>
  </nav>
  <div class="sidebar-footer">
    <button class="logout-btn" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>
</aside>

<div class="main">
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:14px">
      <button class="mob-toggle" onclick="openSidebar()"><i class="fas fa-bars"></i></button>
      <span class="topbar-title" id="topbarTitle">Dashboard</span>
    </div>
    <div class="topbar-right">
      <div class="topbar-badge" id="firebaseBadge"><div class="db-dot" id="topDbDot" style="width:7px;height:7px"></div><span id="topDbText">Firebase</span></div>
      <a href="index.html" target="_blank" class="view-btn"><i class="fas fa-external-link-alt"></i> View Portfolio</a>
    </div>
  </div>

  <div class="content">

    <!-- DASHBOARD -->
    <div class="page active" id="page-dashboard">
      <div class="page-header">
        <div class="page-header-text"><h2>Welcome back, Saadi ðŸ‘‹</h2><p>Your portfolio overview</p></div>
      </div>
      <div class="stats-row">
        <div class="stat-card"><div class="sc-icon"><i class="fas fa-folder"></i></div><div class="sc-label">Total Projects</div><div class="sc-num" id="statTotal">â€”</div></div>
        <div class="stat-card"><div class="sc-icon"><i class="fas fa-eye"></i></div><div class="sc-label">Live Projects</div><div class="sc-num" id="statLive">â€”</div></div>
        <div class="stat-card"><div class="sc-icon"><i class="fas fa-drafting-compass"></i></div><div class="sc-label">Drafts</div><div class="sc-num" id="statDraft">â€”</div></div>
        <div class="stat-card"><div class="sc-icon"><i class="fas fa-database"></i></div><div class="sc-label">Database</div><div class="sc-num" id="statDb" style="font-size:1rem;padding-top:4px">â€”</div></div>
      </div>
      <div class="dash-grid">
        <div class="panel">
          <div class="panel-head"><h3><i class="fas fa-clock" style="color:var(--gold);margin-right:8px"></i>Recent Projects</h3><button class="btn btn-outline btn-sm" onclick="showPage('add-project',null)"><i class="fas fa-plus"></i> Add</button></div>
          <div class="panel-body" id="recentPanel"><div class="loading-row"><i class="fas fa-spinner"></i>Loading...</div></div>
        </div>
        <div class="panel">
          <div class="panel-head"><h3><i class="fas fa-fire" style="color:#f59e0b;margin-right:8px"></i>Firebase Status</h3></div>
          <div class="panel-body">
            <div id="firebaseStatusBlock">
              <div style="text-align:center;padding:20px;color:var(--muted)"><i class="fas fa-spinner fa-spin" style="color:var(--gold);font-size:1.5rem;margin-bottom:10px;display:block"></i>Checking connection...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PROJECTS -->
    <div class="page" id="page-projects">
      <div class="page-header">
        <div class="page-header-text"><h2>All Projects</h2><p>Manage your portfolio projects</p></div>
        <button class="btn btn-gold" onclick="showPage('add-project',null)"><i class="fas fa-plus"></i> Add New</button>
      </div>
      <div style="display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap">
        <button class="btn btn-sm btn-gold" onclick="filterProjects('all',this)">All</button>
        <button class="btn btn-sm btn-outline" onclick="filterProjects('live',this)">Live</button>
        <button class="btn btn-sm btn-outline" onclick="filterProjects('draft',this)">Draft</button>
      </div>
      <div class="panel"><div class="panel-body" style="padding:0;overflow-x:auto"><div id="projectsTableWrap"><div class="loading-row"><i class="fas fa-spinner"></i>Loading projects...</div></div></div></div>
    </div>

    <!-- ADD PROJECT -->
    <div class="page" id="page-add-project">
      <div class="page-header"><div class="page-header-text"><h2 id="addTitle">Add New Project</h2><p>Fill in the details and upload a screenshot</p></div></div>
      <div class="panel"><div class="panel-body">
        <input type="hidden" id="editingId">
        <div class="form-row">
          <div class="form-group"><label>Project Title *</label><input type="text" id="projTitle" placeholder="e.g. Spice Garden Restaurant" maxlength="60" oninput="cc(this,'tc',60)"><div class="char-count"><span id="tc">0</span>/60</div></div>
          <div class="form-group"><label>Category *</label>
            <select id="projCat">
              <option value="">Select category...</option>
              <option>Restaurant</option><option>Beauty Salon</option><option>Fitness</option>
              <option>Real Estate</option><option>Education</option><option>E-commerce</option>
              <option>Business</option><option>Healthcare</option><option>Other</option>
            </select>
          </div>
        </div>
        <div class="form-group"><label>Short Description *</label><textarea id="projDesc" placeholder="Describe what this project does..." maxlength="220" oninput="cc(this,'dc',220)"></textarea><div class="char-count"><span id="dc">0</span>/220</div></div>
        <div class="form-row">
          <div class="form-group"><label>Live Demo URL</label><input type="url" id="projUrl" placeholder="https://example.com"></div>
          <div class="form-group"><label>Status</label><select id="projStatus"><option value="live">Live</option><option value="draft">Draft</option></select></div>
        </div>
        <div class="form-group">
          <label>Project Screenshot</label>
          <div class="img-upload-area" id="uploadArea" ondragover="dOver(event)" ondragleave="dLeave(event)" ondrop="dDrop(event)">
            <input type="file" id="imgInput" accept="image/*" onchange="imgSelect(event)">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Drag & drop or <span>click to upload</span></p>
            <p style="font-size:.75rem;margin-top:4px;opacity:.6">PNG, JPG, WEBP â€” Max 2MB</p>
          </div>
          <div class="img-preview-wrap" id="imgPreviewWrap"></div>
        </div>
        <div style="display:flex;gap:12px;justify-content:flex-end;margin-top:8px">
          <button class="btn btn-outline" onclick="cancelEdit()">Cancel</button>
          <button class="btn btn-gold" id="saveBtn" onclick="saveProject()"><i class="fas fa-save"></i> Save Project</button>
        </div>
      </div></div>
    </div>

    <!-- FIREBASE SETUP PAGE -->
    <div class="page" id="page-firebase">
      <div class="page-header"><div class="page-header-text"><h2>ðŸ”¥ Firebase Setup</h2><p>Connect your Firebase database for permanent project storage</p></div></div>

      <div class="config-box">
        <h4>Step 1 â€” Create a Firebase Project (Free)</h4>
        <div class="step-row"><span class="step-num">1</span><div style="font-size:.88rem;color:var(--muted);line-height:1.7">Go to <strong style="color:var(--text)">console.firebase.google.com</strong> â†’ Click <strong style="color:var(--text)">"Add project"</strong> â†’ Give it a name (e.g. "saadi-portfolio") â†’ Continue</div></div>
        <div class="step-row"><span class="step-num">2</span><div style="font-size:.88rem;color:var(--muted);line-height:1.7">Inside the project â†’ Click <strong style="color:var(--text)">Web icon (&lt;/&gt;)</strong> â†’ Register app â†’ Copy the <strong style="color:var(--text)">firebaseConfig</strong> object</div></div>
        <div class="step-row"><span class="step-num">3</span><div style="font-size:.88rem;color:var(--muted);line-height:1.7">Go to <strong style="color:var(--text)">Firestore Database</strong> â†’ Create database â†’ Choose <strong style="color:var(--text)">"Start in test mode"</strong> â†’ Done</div></div>
      </div>

      <div class="config-box">
        <h4>Step 2 â€” Paste Your Firebase Config</h4>
        <p>Paste your firebaseConfig object below. It looks like this:</p>
        <div class="code-block">const firebaseConfig = {<br>&nbsp;&nbsp;apiKey: "AIzaSy...",<br>&nbsp;&nbsp;authDomain: "your-app.firebaseapp.com",<br>&nbsp;&nbsp;projectId: "your-app-id",<br>&nbsp;&nbsp;storageBucket: "your-app.appspot.com",<br>&nbsp;&nbsp;messagingSenderId: "123456789",<br>&nbsp;&nbsp;appId: "1:123..."<br>};</div>
        <div class="form-group" style="margin-bottom:16px">
          <label>Paste Config JSON Here</label>
          <textarea class="config-textarea" id="fbConfigInput" placeholder='{&#10;  "apiKey": "AIzaSy...",&#10;  "authDomain": "...",&#10;  "projectId": "...",&#10;  "storageBucket": "...",&#10;  "messagingSenderId": "...",&#10;  "appId": "..."&#10;}'></textarea>
        </div>
        <button class="btn btn-gold" onclick="saveFirebaseConfig()"><i class="fas fa-fire"></i> Save & Connect Firebase</button>
        <button class="btn btn-danger" style="margin-left:10px" onclick="clearFirebaseConfig()"><i class="fas fa-trash"></i> Clear Config</button>
      </div>

      <div class="config-box" id="connectionTestBox" style="display:none">
        <h4>Connection Status</h4>
        <div id="connectionResult"></div>
      </div>
    </div>

    <!-- SECURITY -->
    <div class="page" id="page-security">
      <div class="page-header"><div class="page-header-text"><h2>Security</h2><p>Change your admin login password</p></div></div>
      <div class="panel" style="max-width:480px"><div class="panel-body">
        <div class="form-group"><label>Current Password</label><input type="password" id="curPass" placeholder="Current password"></div>
        <div class="form-group"><label>New Password</label><input type="password" id="newPass" placeholder="New password (min 6 chars)"></div>
        <div class="form-group"><label>Confirm New Password</label><input type="password" id="conPass" placeholder="Confirm new password"></div>
        <div style="display:flex;justify-content:flex-end"><button class="btn btn-gold" onclick="changePassword()"><i class="fas fa-lock"></i> Update Password</button></div>
      </div></div>
    </div>

  </div>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="editModal">
  <div class="modal-box">
    <div class="modal-head"><h3>Edit Project</h3><button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button></div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label>Title *</label><input type="text" id="mTitle" maxlength="60"></div>
        <div class="form-group"><label>Category *</label>
          <select id="mCat"><option>Restaurant</option><option>Beauty Salon</option><option>Fitness</option><option>Real Estate</option><option>Education</option><option>E-commerce</option><option>Business</option><option>Healthcare</option><option>Other</option></select>
        </div>
      </div>
      <div class="form-group"><label>Description *</label><textarea id="mDesc" style="min-height:80px" maxlength="220"></textarea></div>
      <div class="form-row">
        <div class="form-group"><label>Demo URL</label><input type="url" id="mUrl"></div>
        <div class="form-group"><label>Status</label><select id="mStatus"><option value="live">Live</option><option value="draft">Draft</option></select></div>
      </div>
      <div class="form-group">
        <label>Replace Screenshot (optional)</label>
        <div class="img-upload-area" style="padding:18px"><input type="file" id="mImg" accept="image/*" onchange="modalImg(event)"><i class="fas fa-image"></i><p style="font-size:.85rem">Click to replace</p></div>
        <div id="mImgPrev" style="margin-top:10px"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
      <button class="btn btn-gold" id="updateBtn" onclick="updateProject()"><i class="fas fa-save"></i> Save Changes</button>
    </div>
  </div>
</div>

<!-- DELETE MODAL -->
<div class="modal-overlay" id="deleteModal">
  <div class="modal-box" style="max-width:400px">
    <div class="modal-head"><h3>Delete Project</h3><button class="modal-close" onclick="closeDelModal()"><i class="fas fa-times"></i></button></div>
    <div class="modal-body" style="text-align:center;padding:36px 28px">
      <i class="fas fa-trash-alt" style="font-size:2.5rem;color:var(--danger);margin-bottom:16px;display:block"></i>
      <h3 style="margin-bottom:8px">Are you sure?</h3>
      <p style="color:var(--muted);font-size:.9rem">Delete "<span id="delName" style="color:var(--text);font-weight:700"></span>"?<br><small>This cannot be undone.</small></p>
    </div>
    <div class="modal-footer"><button class="btn btn-outline" onclick="closeDelModal()">Cancel</button><button class="btn btn-danger" onclick="confirmDelete()"><i class="fas fa-trash"></i> Delete</button></div>
  </div>
</div>

<div class="toast-wrap" id="toastWrap"></div>

<!-- FIREBASE SDK -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, orderBy, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

// â”€â”€â”€ GLOBALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let db = null;
let fbApp = null;
let firebaseReady = false;
let allProjects = [];
let currentFilter = 'all';
let editingId = null;
let deletingId = null;
let currentImage = null;
let modalImage = null;
let adminPass = localStorage.getItem('ss_admin_pass') || 'saadi1234';

// â”€â”€â”€ FIREBASE INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initFirebase(config) {
  try {
    if (fbApp) { try { fbApp.delete(); } catch(e){} }
    fbApp = initializeApp(config, 'saadi-portfolio-' + Date.now());
    db = getFirestore(fbApp);
    return true;
  } catch(e) {
    console.error('Firebase init error:', e);
    return false;
  }
}

async function testFirebase() {
  if (!db) return false;
  try {
    await getDocs(collection(db, 'projects'));
    return true;
  } catch(e) {
    return false;
  }
}

async function loadFromFirebase() {
  if (!db) return [];
  try {
    const q = query(collection(db, 'projects'), orderBy('createdAt', 'desc'));
    const snap = await getDocs(q);
    return snap.docs.map(d => ({ id: d.id, ...d.data() }));
  } catch(e) {
    console.error('Load error:', e);
    return [];
  }
}

async function addToFirebase(data) {
  if (!db) throw new Error('Firebase not connected');
  const ref = await addDoc(collection(db, 'projects'), { ...data, createdAt: Date.now() });
  return ref.id;
}

async function updateInFirebase(id, data) {
  if (!db) throw new Error('Firebase not connected');
  await updateDoc(doc(db, 'projects', id), { ...data, updatedAt: Date.now() });
}

async function deleteFromFirebase(id) {
  if (!db) throw new Error('Firebase not connected');
  await deleteDoc(doc(db, 'projects', id));
}

// â”€â”€â”€ STARTUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('DOMContentLoaded', async () => {
  const saved = localStorage.getItem('ss_fb_config');
  if (saved) {
    try {
      const cfg = JSON.parse(saved);
      const ok = initFirebase(cfg);
      if (ok) {
        const connected = await testFirebase();
        firebaseReady = connected;
        updateDbStatus(connected);
        if (connected) {
          document.getElementById('configBanner').classList.add('hidden');
          document.body.classList.remove('config-shown');
        }
      } else { updateDbStatus(false); }
    } catch(e) { updateDbStatus(false); }
  } else {
    updateDbStatus(false);
    document.body.classList.add('config-shown');
  }
});

function updateDbStatus(ok) {
  const dot = document.getElementById('dbDot');
  const txt = document.getElementById('dbStatusText');
  const tdot = document.getElementById('topDbDot');
  const ttxt = document.getElementById('topDbText');
  if (ok) {
    dot.className = 'db-dot connected'; txt.textContent = 'Firebase Connected âœ“';
    tdot.className = 'db-dot connected'; ttxt.textContent = 'Firebase Live';
    document.getElementById('statDb').textContent = 'Live âœ“';
    document.getElementById('firebaseStatusBlock').innerHTML = `
      <div style="display:flex;flex-direction:column;gap:12px">
        <div style="display:flex;align-items:center;gap:12px;padding:14px;background:rgba(37,211,102,0.06);border:1px solid rgba(37,211,102,0.2);border-radius:12px">
          <i class="fas fa-check-circle" style="color:var(--success);font-size:1.3rem"></i>
          <div><div style="font-weight:700;color:var(--success)">Firebase Connected!</div><div style="font-size:.82rem;color:var(--muted);margin-top:2px">Projects save permanently to the database</div></div>
        </div>
        <div style="font-size:.82rem;color:var(--muted);padding:0 4px">Your portfolio will now show live projects from Firebase on any device, any browser.</div>
      </div>`;
  } else {
    dot.className = 'db-dot'; txt.textContent = 'Firebase not set up';
    tdot.className = 'db-dot error'; ttxt.textContent = 'No Firebase';
    document.getElementById('statDb').textContent = 'Setup Required';
    document.getElementById('firebaseStatusBlock').innerHTML = `
      <div style="display:flex;flex-direction:column;gap:12px">
        <div style="display:flex;align-items:center;gap:12px;padding:14px;background:rgba(232,87,87,0.06);border:1px solid rgba(232,87,87,0.2);border-radius:12px">
          <i class="fas fa-exclamation-triangle" style="color:var(--danger);font-size:1.3rem"></i>
          <div><div style="font-weight:700;color:var(--danger)">Firebase Not Connected</div><div style="font-size:.82rem;color:var(--muted);margin-top:2px">Projects won't save permanently</div></div>
        </div>
        <button class="btn btn-gold btn-sm" onclick="showPage('firebase',null)" style="width:fit-content"><i class="fas fa-fire"></i> Set Up Firebase Now</button>
      </div>`;
  }
}

// â”€â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.doLogin = function() {
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value;
  if (u === 'admin' && p === adminPass) {
    document.getElementById('loginScreen').classList.add('hide');
    loadDashboard();
    toast('Welcome back, Saadi! ðŸ‘‹', 'success');
  } else {
    document.getElementById('loginError').style.display = 'block';
    document.getElementById('loginPass').style.borderColor = 'var(--danger)';
    setTimeout(() => document.getElementById('loginPass').style.borderColor = '', 2000);
  }
};

window.doLogout = function() {
  document.getElementById('loginScreen').classList.remove('hide');
  document.getElementById('loginUser').value = '';
  document.getElementById('loginPass').value = '';
  document.getElementById('loginError').style.display = 'none';
};

window.changePassword = function() {
  const cur = document.getElementById('curPass').value;
  const np  = document.getElementById('newPass').value;
  const cp  = document.getElementById('conPass').value;
  if (cur !== adminPass) { toast('Current password incorrect', 'error'); return; }
  if (np.length < 6)     { toast('Min 6 characters required', 'error'); return; }
  if (np !== cp)         { toast('Passwords do not match', 'error'); return; }
  adminPass = np;
  localStorage.setItem('ss_admin_pass', np);
  ['curPass','newPass','conPass'].forEach(id => document.getElementById(id).value = '');
  toast('Password updated!', 'success');
};

// â”€â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.showPage = function(pageId, navEl) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + pageId).classList.add('active');
  if (navEl) navEl.classList.add('active');
  const titles = { dashboard:'Dashboard', projects:'All Projects', 'add-project':'Add Project', firebase:'Firebase Setup', security:'Security' };
  document.getElementById('topbarTitle').textContent = titles[pageId] || pageId;
  if (pageId === 'projects') loadProjectsTable();
  if (pageId === 'dashboard') loadDashboard();
  if (pageId === 'add-project') resetForm();
  if (pageId === 'firebase') loadFirebaseConfig();
  closeSidebar();
};

// â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadDashboard() {
  document.getElementById('statTotal').textContent = 'â€¦';
  document.getElementById('statLive').textContent = 'â€¦';
  document.getElementById('statDraft').textContent = 'â€¦';
  document.getElementById('recentPanel').innerHTML = '<div class="loading-row"><i class="fas fa-spinner"></i>Loading...</div>';
  try {
    const projs = await loadFromFirebase();
    allProjects = projs;
    const live = projs.filter(p => p.status === 'live').length;
    const draft = projs.filter(p => p.status === 'draft').length;
    document.getElementById('statTotal').textContent = projs.length;
    document.getElementById('statLive').textContent = live;
    document.getElementById('statDraft').textContent = draft;
    const panel = document.getElementById('recentPanel');
    const recent = projs.slice(0, 4);
    if (!recent.length) {
      panel.innerHTML = '<div class="empty-state"><i class="fas fa-folder-open"></i><p>No projects yet. Add your first one!</p></div>';
    } else {
      panel.innerHTML = recent.map(p => `
        <div style="display:flex;align-items:center;gap:14px;padding:10px 0;border-bottom:1px solid rgba(201,168,76,0.06)">
          ${p.image ? `<img src="${p.image}" style="width:52px;height:40px;border-radius:8px;object-fit:cover;border:1px solid var(--border);flex-shrink:0">` : `<div style="width:52px;height:40px;border-radius:8px;background:var(--surface2);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;color:var(--muted);flex-shrink:0"><i class="fas fa-image"></i></div>`}
          <div style="flex:1;min-width:0">
            <div style="font-weight:600;font-size:.9rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.title}</div>
            <div style="color:var(--muted);font-size:.75rem;margin-top:2px">${p.category}</div>
          </div>
          <div class="status-${p.status}">${p.status === 'live' ? 'Live' : 'Draft'}</div>
        </div>`).join('');
    }
  } catch(e) {
    document.getElementById('statTotal').textContent = 'â€”';
    document.getElementById('recentPanel').innerHTML = '<div class="empty-state"><i class="fas fa-database"></i><p>Firebase not connected</p></div>';
  }
}

// â”€â”€â”€ PROJECTS TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadProjectsTable(filter = currentFilter) {
  const wrap = document.getElementById('projectsTableWrap');
  wrap.innerHTML = '<div class="loading-row"><i class="fas fa-spinner"></i>Loading projects...</div>';
  try {
    let projs = await loadFromFirebase();
    allProjects = projs;
    if (filter !== 'all') projs = projs.filter(p => p.status === filter);
    if (!projs.length) {
      wrap.innerHTML = '<div class="empty-state" style="padding:40px"><i class="fas fa-folder-open"></i><p>No projects found.</p></div>';
      return;
    }
    wrap.innerHTML = `<table class="proj-table"><thead><tr><th>Screenshot</th><th>Title</th><th>Category</th><th>Status</th><th>Actions</th></tr></thead><tbody>
      ${projs.map(p => `<tr>
        <td>${p.image ? `<img src="${p.image}" class="proj-thumb">` : `<div class="proj-thumb-ph"><i class="fas fa-image"></i></div>`}</td>
        <td style="max-width:200px"><div style="font-weight:600;font-size:.88rem">${p.title}</div><div style="color:var(--muted);font-size:.75rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:180px;margin-top:2px">${p.desc}</div></td>
        <td><span class="tag-badge">${p.category}</span></td>
        <td><div class="status-${p.status}">${p.status === 'live' ? 'Live' : 'Draft'}</div></td>
        <td><div class="actions-cell">
          ${p.url ? `<a href="${p.url}" target="_blank" class="btn btn-sm btn-outline" title="Demo"><i class="fas fa-external-link-alt"></i></a>` : ''}
          <button class="btn btn-sm btn-outline" onclick="openEdit('${p.id}')" title="Edit"><i class="fas fa-pen"></i></button>
          <button class="btn btn-sm btn-danger" onclick="openDel('${p.id}','${p.title.replace(/'/g,'&#39;')}')" title="Delete"><i class="fas fa-trash"></i></button>
        </div></td>
      </tr>`).join('')}
    </tbody></table>`;
  } catch(e) {
    wrap.innerHTML = '<div class="empty-state"><i class="fas fa-database"></i><p>Firebase not connected. Set up Firebase first.</p></div>';
  }
}

window.filterProjects = function(type, btn) {
  currentFilter = type;
  document.querySelectorAll('[onclick^="filterProjects"]').forEach(b => b.className = 'btn btn-sm btn-outline');
  btn.className = 'btn btn-sm btn-gold';
  loadProjectsTable(type);
};

// â”€â”€â”€ ADD/SAVE PROJECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetForm() {
  document.getElementById('editingId').value = '';
  document.getElementById('addTitle').textContent = 'Add New Project';
  ['projTitle','projDesc','projUrl'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('projCat').value = '';
  document.getElementById('projStatus').value = 'live';
  document.getElementById('imgPreviewWrap').innerHTML = '';
  document.getElementById('tc').textContent = '0';
  document.getElementById('dc').textContent = '0';
  currentImage = null;
}

window.cancelEdit = function() { resetForm(); showPage('projects', document.querySelectorAll('.nav-item')[1]); };
window.cc = function(el, cid, max) { document.getElementById(cid).textContent = el.value.length; };

window.imgSelect = function(e) {
  const file = e.target.files[0];
  if (!file) return;
  if (file.size > 2 * 1024 * 1024) { toast('Max 2MB image size', 'error'); return; }
  const r = new FileReader();
  r.onload = ev => {
    currentImage = ev.target.result;
    document.getElementById('imgPreviewWrap').innerHTML = `<div class="img-preview-item"><img src="${currentImage}"><button class="remove-img" onclick="removeImg()"><i class="fas fa-times"></i></button></div>`;
  };
  r.readAsDataURL(file);
};

window.removeImg = function() { currentImage = null; document.getElementById('imgPreviewWrap').innerHTML = ''; document.getElementById('imgInput').value = ''; };
window.dOver = function(e) { e.preventDefault(); document.getElementById('uploadArea').classList.add('dragover'); };
window.dLeave = function() { document.getElementById('uploadArea').classList.remove('dragover'); };
window.dDrop = function(e) {
  e.preventDefault(); document.getElementById('uploadArea').classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (!file || !file.type.startsWith('image/')) { toast('Please drop an image file', 'error'); return; }
  if (file.size > 2 * 1024 * 1024) { toast('Max 2MB', 'error'); return; }
  const r = new FileReader();
  r.onload = ev => {
    currentImage = ev.target.result;
    document.getElementById('imgPreviewWrap').innerHTML = `<div class="img-preview-item"><img src="${currentImage}"><button class="remove-img" onclick="removeImg()"><i class="fas fa-times"></i></button></div>`;
  };
  r.readAsDataURL(file);
};

window.saveProject = async function() {
  if (!firebaseReady) { toast('Please set up Firebase first!', 'error'); showPage('firebase', null); return; }
  const title = document.getElementById('projTitle').value.trim();
  const cat   = document.getElementById('projCat').value;
  const desc  = document.getElementById('projDesc').value.trim();
  const url   = document.getElementById('projUrl').value.trim();
  const status = document.getElementById('projStatus').value;
  if (!title) { toast('Project title is required', 'error'); return; }
  if (!cat)   { toast('Please select a category', 'error'); return; }
  if (!desc)  { toast('Description is required', 'error'); return; }
  const btn = document.getElementById('saveBtn');
  btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
  try {
    await addToFirebase({ title, category: cat, desc, url, status, image: currentImage || null });
    toast('Project saved to Firebase! âœ“', 'success');
    resetForm();
    showPage('projects', document.querySelectorAll('.nav-item')[1]);
  } catch(e) {
    toast('Error saving: ' + e.message, 'error');
  }
  btn.disabled = false; btn.innerHTML = '<i class="fas fa-save"></i> Save Project';
};

// â”€â”€â”€ EDIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openEdit = function(id) {
  const p = allProjects.find(x => x.id === id);
  if (!p) return;
  editingId = id; modalImage = p.image || null;
  document.getElementById('mTitle').value = p.title;
  document.getElementById('mCat').value = p.category;
  document.getElementById('mDesc').value = p.desc;
  document.getElementById('mUrl').value = p.url || '';
  document.getElementById('mStatus').value = p.status;
  document.getElementById('mImgPrev').innerHTML = p.image ? `<img src="${p.image}" style="width:80px;height:60px;object-fit:cover;border-radius:8px;border:1px solid var(--border)">` : '';
  document.getElementById('editModal').classList.add('open');
};

window.modalImg = function(e) {
  const file = e.target.files[0];
  if (!file) return;
  if (file.size > 2 * 1024 * 1024) { toast('Max 2MB', 'error'); return; }
  const r = new FileReader();
  r.onload = ev => {
    modalImage = ev.target.result;
    document.getElementById('mImgPrev').innerHTML = `<img src="${modalImage}" style="width:80px;height:60px;object-fit:cover;border-radius:8px;border:1px solid var(--border)">`;
  };
  r.readAsDataURL(file);
};

window.updateProject = async function() {
  const title = document.getElementById('mTitle').value.trim();
  const cat   = document.getElementById('mCat').value;
  const desc  = document.getElementById('mDesc').value.trim();
  const url   = document.getElementById('mUrl').value.trim();
  const status = document.getElementById('mStatus').value;
  if (!title) { toast('Title required', 'error'); return; }
  const btn = document.getElementById('updateBtn');
  btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
  try {
    const orig = allProjects.find(x => x.id === editingId);
    await updateInFirebase(editingId, { title, category: cat, desc, url, status, image: modalImage || (orig ? orig.image : null) });
    toast('Project updated! âœ“', 'success');
    closeModal();
    loadProjectsTable();
    loadDashboard();
  } catch(e) {
    toast('Update error: ' + e.message, 'error');
  }
  btn.disabled = false; btn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
};

window.closeModal = function() { document.getElementById('editModal').classList.remove('open'); editingId = null; modalImage = null; document.getElementById('mImg').value = ''; };

// â”€â”€â”€ DELETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openDel = function(id, name) {
  deletingId = id;
  document.getElementById('delName').textContent = name;
  document.getElementById('deleteModal').classList.add('open');
};
window.closeDelModal = function() { document.getElementById('deleteModal').classList.remove('open'); deletingId = null; };
window.confirmDelete = async function() {
  try {
    await deleteFromFirebase(deletingId);
    toast('Project deleted', 'info');
    closeDelModal();
    loadProjectsTable();
    loadDashboard();
  } catch(e) { toast('Delete error: ' + e.message, 'error'); }
};

// â”€â”€â”€ FIREBASE CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadFirebaseConfig() {
  const saved = localStorage.getItem('ss_fb_config');
  if (saved) {
    try { document.getElementById('fbConfigInput').value = JSON.stringify(JSON.parse(saved), null, 2); } catch(e) {}
  }
}

window.saveFirebaseConfig = async function() {
  const raw = document.getElementById('fbConfigInput').value.trim();
  if (!raw) { toast('Please paste your Firebase config', 'error'); return; }
  let cfg;
  try {
    // Allow both JSON object and JS object syntax
    let cleaned = raw;
    if (cleaned.includes('apiKey:')) {
      // Convert JS object to JSON
      cleaned = cleaned
        .replace(/\/\/.*$/gm,'')
        .replace(/const\s+firebaseConfig\s*=\s*/,'')
        .replace(/;?\s*$/,'')
        .replace(/([{,]\s*)([a-zA-Z_][a-zA-Z0-9_]*)\s*:/g, '$1"$2":')
        .replace(/'/g, '"');
    }
    cfg = JSON.parse(cleaned);
  } catch(e) {
    toast('Invalid config format. Please check the JSON', 'error');
    return;
  }
  const ok = initFirebase(cfg);
  if (!ok) { toast('Failed to initialize Firebase', 'error'); return; }
  const connected = await testFirebase();
  if (connected) {
    localStorage.setItem('ss_fb_config', JSON.stringify(cfg));
    firebaseReady = true;
    updateDbStatus(true);
    document.getElementById('configBanner').classList.add('hidden');
    document.body.classList.remove('config-shown');
    document.getElementById('connectionTestBox').style.display = 'block';
    document.getElementById('connectionResult').innerHTML = `<div style="display:flex;align-items:center;gap:12px;padding:14px;background:rgba(37,211,102,0.08);border:1px solid rgba(37,211,102,0.25);border-radius:12px"><i class="fas fa-check-circle" style="color:var(--success);font-size:1.4rem"></i><div><div style="font-weight:700;color:var(--success)">Successfully connected!</div><div style="font-size:.82rem;color:var(--muted);margin-top:2px">Firebase is now active. All projects save permanently.</div></div></div>`;
    toast('Firebase connected! Projects will now save permanently âœ“', 'success');
  } else {
    document.getElementById('connectionTestBox').style.display = 'block';
    document.getElementById('connectionResult').innerHTML = `<div style="display:flex;align-items:center;gap:12px;padding:14px;background:rgba(232,87,87,0.08);border:1px solid rgba(232,87,87,0.25);border-radius:12px"><i class="fas fa-times-circle" style="color:var(--danger);font-size:1.4rem"></i><div><div style="font-weight:700;color:var(--danger)">Connection failed</div><div style="font-size:.82rem;color:var(--muted);margin-top:2px">Check your config & make sure Firestore is enabled in test mode</div></div></div>`;
    toast('Connection failed. Check your config', 'error');
  }
};

window.clearFirebaseConfig = function() {
  localStorage.removeItem('ss_fb_config');
  db = null; fbApp = null; firebaseReady = false;
  document.getElementById('fbConfigInput').value = '';
  updateDbStatus(false);
  document.getElementById('configBanner').classList.remove('hidden');
  document.body.classList.add('config-shown');
  toast('Firebase config cleared', 'info');
};

// â”€â”€â”€ MOBILE / UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openSidebar = function() { document.getElementById('sidebar').classList.add('open'); document.getElementById('sidebarOverlay').classList.add('show'); };
window.closeSidebar = function() { document.getElementById('sidebar').classList.remove('open'); document.getElementById('sidebarOverlay').classList.remove('show'); };

window.toast = function(msg, type='info') {
  const icons = { success:'fa-check-circle', error:'fa-exclamation-circle', info:'fa-info-circle' };
  const wrap = document.getElementById('toastWrap');
  const t = document.createElement('div');
  t.className = `toast ${type}`;
  t.innerHTML = `<i class="fas ${icons[type]} t-icon"></i><span>${msg}</span>`;
  wrap.appendChild(t);
  setTimeout(() => { t.style.opacity='0'; t.style.transform='translateX(20px)'; t.style.transition='.3s ease'; setTimeout(()=>t.remove(),350); }, 3500);
};

document.getElementById('editModal').addEventListener('click', e => { if(e.target === document.getElementById('editModal')) closeModal(); });
document.getElementById('deleteModal').addEventListener('click', e => { if(e.target === document.getElementById('deleteModal')) closeDelModal(); });
</script>
</body>
</html>
